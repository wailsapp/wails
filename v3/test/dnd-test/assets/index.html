<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DnD Test - Internal vs External</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
            min-height: 100vh;
        }
        h1 { text-align: center; color: #fff; margin-top: 10px; }
        h2 { color: #888; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; margin: 20px 0 10px; }
        
        .section {
            max-width: 800px;
            margin: 0 auto 30px;
            padding: 20px;
            background: #16213e;
            border-radius: 12px;
        }
        
        /* External DnD - files from OS */
        .file-drop-zone {
            padding: 40px;
            border: 3px dashed #444;
            border-radius: 12px;
            text-align: center;
            transition: all 0.2s ease;
        }
        .file-drop-zone.file-drop-target-active {
            border-color: #4a9eff;
            background: rgba(74, 158, 255, 0.1);
        }
        
        /* Internal DnD - HTML5 drag between elements */
        .internal-dnd {
            display: flex;
            gap: 20px;
        }
        .drag-source {
            flex: 1;
        }
        .draggable-item {
            padding: 15px;
            margin: 10px 0;
            background: #2a3a5e;
            border-radius: 8px;
            cursor: grab;
            transition: all 0.2s;
        }
        .draggable-item:hover {
            background: #3a4a7e;
        }
        .draggable-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        .drop-target {
            flex: 1;
            min-height: 200px;
            padding: 15px;
            border: 2px dashed #444;
            border-radius: 8px;
        }
        .drop-target.drag-over {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
        }
        .dropped-item {
            padding: 10px;
            margin: 5px 0;
            background: #27ae60;
            border-radius: 6px;
            color: #fff;
        }
        
        /* Log */
        .log {
            max-height: 200px;
            overflow-y: auto;
            background: #0d1117;
            border-radius: 8px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry { margin: 2px 0; }
        .log-entry.external { color: #4a9eff; }
        .log-entry.internal { color: #27ae60; }
        .log-entry.gtk { color: #e74c3c; }
    </style>
</head>
<body>
    <h1>DnD Test - Internal vs External</h1>
    
    <div class="section">
        <h2>Test 1: External DnD (Files from OS)</h2>
        <p style="color: #666; font-size: 14px;">Drag files from your file manager into this zone. Should trigger Go events.</p>
        <div class="file-drop-zone" data-file-drop-target id="file-drop">
            Drop files from your desktop here
        </div>
    </div>
    
    <div class="section">
        <h2>Test 2: Internal DnD (HTML5 - within page)</h2>
        <p style="color: #666; font-size: 14px;">Drag the boxes from left to right. Should NOT trigger Go events - pure JavaScript.</p>
        <div class="internal-dnd">
            <div class="drag-source">
                <h3 style="margin: 0 0 10px; color: #888;">Drag these:</h3>
                <div class="draggable-item" draggable="true" data-id="1">Item 1 - Drag me!</div>
                <div class="draggable-item" draggable="true" data-id="2">Item 2 - Drag me!</div>
                <div class="draggable-item" draggable="true" data-id="3">Item 3 - Drag me!</div>
            </div>
            <div class="drop-target" id="internal-drop">
                <h3 style="margin: 0 0 10px; color: #888;">Drop here:</h3>
                <div id="dropped-items"></div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <h2>Event Log</h2>
        <div class="log" id="log"></div>
    </div>

    <script>
        const log = document.getElementById('log');
        
        function addLog(message, type = '') {
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + type;
            entry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        // ========== INTERNAL DnD (HTML5) ==========
        const draggables = document.querySelectorAll('.draggable-item');
        const internalDrop = document.getElementById('internal-drop');
        const droppedItems = document.getElementById('dropped-items');
        
        draggables.forEach(item => {
            item.addEventListener('dragstart', (e) => {
                item.classList.add('dragging');
                e.dataTransfer.setData('text/plain', item.dataset.id);
                e.dataTransfer.effectAllowed = 'move';
                addLog(`[HTML5] dragstart: Item ${item.dataset.id}`, 'internal');
            });
            
            item.addEventListener('dragend', (e) => {
                item.classList.remove('dragging');
                addLog(`[HTML5] dragend: Item ${item.dataset.id}`, 'internal');
            });
        });
        
        internalDrop.addEventListener('dragenter', (e) => {
            e.preventDefault();
            internalDrop.classList.add('drag-over');
            addLog('[HTML5] dragenter on drop target', 'internal');
        });
        
        internalDrop.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        });
        
        internalDrop.addEventListener('dragleave', (e) => {
            // Only remove if we're leaving the drop target entirely
            if (!internalDrop.contains(e.relatedTarget)) {
                internalDrop.classList.remove('drag-over');
                addLog('[HTML5] dragleave from drop target', 'internal');
            }
        });
        
        internalDrop.addEventListener('drop', (e) => {
            e.preventDefault();
            internalDrop.classList.remove('drag-over');
            
            const itemId = e.dataTransfer.getData('text/plain');
            addLog(`[HTML5] drop: Item ${itemId} dropped!`, 'internal');
            
            // Create dropped item
            const dropped = document.createElement('div');
            dropped.className = 'dropped-item';
            dropped.textContent = `Dropped: Item ${itemId}`;
            droppedItems.appendChild(dropped);
        });
        
        // ========== EXTERNAL DnD (Files from OS) ==========
        const fileDrop = document.getElementById('file-drop');
        
        // These events are for visual feedback only - actual file handling is done by Wails
        fileDrop.addEventListener('dragenter', (e) => {
            if (e.dataTransfer.types.includes('Files')) {
                addLog('[JS] dragenter with Files detected', 'external');
            }
        });
        
        fileDrop.addEventListener('dragleave', (e) => {
            if (e.dataTransfer.types.includes('Files')) {
                addLog('[JS] dragleave with Files', 'external');
            }
        });
        
        fileDrop.addEventListener('drop', (e) => {
            addLog(`[JS] drop event - ${e.dataTransfer.files.length} files (but Wails handles this)`, 'external');
        });
        
        // Listen for Wails file drop events
        if (window.wails) {
            // This would be set up by the Wails runtime
            addLog('Wails runtime detected', 'external');
        }
        
        addLog('Test page loaded - try both drag scenarios!');
    </script>
</body>
</html>
