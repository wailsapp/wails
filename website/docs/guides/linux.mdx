# Linux

This page has miscellaneous guides related to developing Wails applications for Linux.

## Video tag doesn't fire "ended" event

When using a video tag, the "ended" event is not fired when the video is finished playing. This is a bug
in WebkitGTK, however you can use the following workaround to fix it:

```js
videoTag.addEventListener("timeupdate", (event) => {
  if (event.target.duration - event.target.currentTime < 0.2) {
    let ended = new Event("ended");
    event.target.dispatchEvent(ended);
  }
});
```

Source: [Lyimmi](https://github.com/Lyimmi) on the
[discussions board](https://github.com/wailsapp/wails/issues/1729#issuecomment-1212291275)

## GStreamer error when using Audio or Video elements

If you are seeing the following error when including `<Audio>` or `<Video>` elements on Linux, you may need to install `gst-plugins-good`.

```
GStreamer element autoaudiosink not found. Please install it
```

### Installing

Run the following distro relevant install command:

```mdx-code-block
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

<Tabs
    defaultValue="Arch"
    values={[
        { label: "Arch", value: "Arch" },
        { label: "Debian/Ubuntu", value: "Debian" },
        { label: "Fedora", value: "Fedora" },
    ]}
>
<TabItem value="Arch">

    pacman -S gst-plugins-good

</TabItem>
<TabItem value="Debian">

    apt-get install gstreamer1.0-plugins-good

</TabItem>
<TabItem value="Fedora">

    dnf install gstreamer1-plugins-good

</TabItem>
</Tabs>
```

If the added package does not resolve the issue, additional GStreamer dependencies may be required. [See the GStreamer installation page for more details.](https://gstreamer.freedesktop.org/documentation/installing/on-linux.html)

### Additional Notes

- This issue is caused by [an upstream issue with WebkitGTK](https://bugs.webkit.org/show_bug.cgi?id=146351).
- [Arch based systems](https://wiki.archlinux.org/title/Arch-based_distributions) seem to have this issue more often than other distributions.
- This issue impacts [Tauri apps](https://tauri.app/).

Source: [developomp](https://github.com/developomp) on the [Tauri discussion board](https://github.com/tauri-apps/tauri/issues/4642#issuecomment-1643229562).

## Debugging with Delve

When debugging Wails applications on Linux using [Delve](https://github.com/go-delve/delve) (the Go debugger), you may experience crashes when hitting breakpoints. This is caused by a conflict between Wails' GTK signal handler configuration and Delve's debugging mechanism.

### The Problem

Wails applies a signal handler fixup during GTK initialization that adds the `SA_ONSTACK` flag to various signals (including `SIGSEGV`, `SIGBUS`, `SIGABRT`, etc.). This fixup is necessary for CGO compatibility with Go's signal handling and prevents crashes in certain scenarios (such as when using gRPC). However, it can interfere with Delve's ability to properly handle signals during debugging, causing the application to crash when breakpoints are hit.

### The Solution

To debug your application with Delve, disable the GTK signal handler fixup by setting `DisableGTKSignalHandlerFixup` to `true` in your Linux options:

```go
app := application.New(application.Options{
    Name: "My App",
    Linux: application.LinuxOptions{
        DisableGTKSignalHandlerFixup: true,
    },
    // ... other options
})
```

### Using Build Tags for Debug Builds

A recommended approach is to use build tags to enable this option only during development/debugging:

**main.go** (production):
```go
//go:build !debug

package main

var linuxOptions = application.LinuxOptions{}
```

**main_debug.go** (debug builds):
```go
//go:build debug

package main

var linuxOptions = application.LinuxOptions{
    DisableGTKSignalHandlerFixup: true,
}
```

**main_common.go**:
```go
package main

func main() {
    app := application.New(application.Options{
        Name:  "My App",
        Linux: linuxOptions,
        // ... other options
    })
    // ...
}
```

Then build with debug support using:
```bash
go build -tags debug -gcflags="all=-N -l" .
```

### Important Notes

- Only disable the signal handler fixup when debugging. In production builds, the fixup should remain enabled to ensure compatibility with CGO libraries.
- If you encounter "signal arrived during cgo execution" errors in production, make sure `DisableGTKSignalHandlerFixup` is `false` (the default).
- This option only affects Linux builds and is ignored on other platforms.
